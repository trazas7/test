export async function getPptSelectedTextOrShape(): Promise<string> {
  return PowerPoint.run(async (ctx) => {
    // 1) try highlighted text
    const sel = ctx.presentation.getSelectedTextRangeOrNullObject();
    await ctx.sync();

    if (!sel.isNullObject) {
      sel.load("text");
      await ctx.sync();
      return (sel.text ?? "").trim();
    }

    // 2) fallback: check if a textbox shape is selected
    const shapes = ctx.presentation.getSelectedShapes();
    shapes.load("items");
    await ctx.sync();

    if (shapes.items.length) {
      shapes.items.forEach(s => s.load("type,textFrame/hasText,textFrame/textRange/text"));
      await ctx.sync();

      for (const s of shapes.items as any[]) {
        if (s.type === "TextBox" && s.textFrame?.hasText && s.textFrame?.textRange?.text) {
          return (s.textFrame.textRange.text ?? "").trim();
        }
      }
    }

    return ""; // nothing usable
  });
}